"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[47],{66047:(e,n,t)=>{t.r(n),t.d(n,{default:()=>an});var r=t(65043),i=t(8192),s=t(78837),d=t(21261),l=t(5073),a=t(57879),o=t(60446),c=t.n(o),u=t(51318),x=t(68555),h=t(70579);const j=e=>{let{checked:n,onCheckedChange:t,...r}=e;return(0,h.jsx)(x.A,{count:1,value:n?1:0,onChange:e=>null===t||void 0===t?void 0:t(!!e),...r})};var m=t(71146),p=t(82907);const v=e=>{let{fromId:n,type:t,referenceId:r,list:i}=e;const s=[...i],d=s.findIndex((e=>e.id===n));if(!r)return C([...s],d,s.length-1);const l=s.findIndex((e=>e.id===r));return("after"===t?C:f)([...s],d,l)},f=(e,n,t)=>{const r=e[t],i=e.splice(n,1)[0],s=e.indexOf(r);return e.splice(s,0,i),e},C=(e,n,t)=>{const r=e[t],i=e.splice(n,1)[0],s=e.indexOf(r);return e.splice(s+1,0,i),e},g=(e,n)=>{const t=(0,p.useQueryClient)();return{onSuccess:()=>t.invalidateQueries(e),async onMutate(r){const i=t.getQueryData(e);return t.setQueryData(e,(e=>n(r,e))),{previousItems:i}},onError(n,r,i){t.setQueryData(e,i.previousItems)}}},y=e=>g(e,((e,n)=>(null===n||void 0===n?void 0:n.filter((n=>n.id!==e.id)))||[])),b=e=>g(e,((e,n)=>(null===n||void 0===n?void 0:n.map((n=>n.id===e.id?{...n,...e}:n)))||[])),L=e=>g(e,((e,n)=>n?[...n,e]:[])),k=e=>{const n=(0,m.q)();return(0,p.useQuery)(["projects",(0,i.jv)(e)],(()=>n("projects",{data:e})))},A=e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n(`projects/${e.id}`,{method:"PATCH",data:e})),b(e))},I=e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("projects",{data:e,method:"POST"})),L(e))},M=e=>{const n=(0,m.q)();return(0,p.useQuery)(["project",{id:e}],(()=>n(`projects/${e}`)),{enabled:Boolean(e)})};var w=t(67824);const E=e=>{const[n]=(0,u.ok)(),t=T(),[s]=(0,r.useState)(e);return[(0,r.useMemo)((()=>(0,i.LE)(Object.fromEntries(n),s)),[n,s]),e=>t(e)]},T=()=>{const[e,n]=(0,u.ok)();return t=>{const r=(0,i.jv)({...Object.fromEntries(e),...t});return n(r)}},O=()=>{const[e,n]=E(["name","personId"]);return[(0,r.useMemo)((()=>({...e,personId:Number(e.personId)||void 0})),[e]),n]},q=()=>{const[e]=O();return["projects",e]},N=()=>{const[{projectCreate:e},n]=E(["projectCreate"]),[{editingProjectId:t},r]=E(["editingProjectId"]),i=T(),{data:s,isLoading:d}=M(Number(t));return{projectModalOpen:"true"===e||Boolean(t),open:()=>n({projectCreate:!0}),close:()=>i({projectCreate:"",editingProjectId:""}),startEdit:e=>r({editingProjectId:e}),editingProject:s,isLoading:d}},P=r.memo((e=>{let{users:n,...t}=e;const{mutate:r}=A(q());return(0,h.jsx)(s.A,{rowKey:"id",pagination:!1,columns:[{title:(0,h.jsx)(j,{checked:!0,disabled:!0}),render(e,n){return(0,h.jsx)(j,{checked:n.pin,onCheckedChange:(t=n.id,e=>r({id:t,pin:e}))});var t}},{title:"\u540d\u79f0",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>(0,h.jsx)(u.N_,{to:`projects/${String(n.id)}`,children:n.name})},{title:"\u90e8\u95e8",dataIndex:"organization"},{title:"\u8d1f\u8d23\u4eba",render(e,t){var r;return(0,h.jsx)("span",{children:(null===(r=n.find((e=>e.id===t.personId)))||void 0===r?void 0:r.name)||"\u672a\u77e5"})}},{title:"\u521b\u5efa\u65f6\u95f4",render:(e,n)=>(0,h.jsx)("span",{children:n.created?c()(n.created).format("YYYY-MM-DD"):"\u65e0"})},{render:(e,n)=>(0,h.jsx)(Z,{project:n})}],...t})})),Z=e=>{let{project:n}=e;const{startEdit:t}=N(),{mutate:r}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>{let{id:t}=e;return n(`projects/${t}`,{method:"DELETE"})}),y(e))})(q());return(0,h.jsx)(l.A,{overlay:(0,h.jsxs)(a.A,{children:[(0,h.jsx)(a.A.Item,{onClick:(i=n.id,()=>t(i)),children:"\u7f16\u8f91"},"edit"),(0,h.jsx)(a.A.Item,{onClick:()=>(e=>{d.A.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417?",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk(){r({id:e})}})})(n.id),children:"\u5220\u9664"},"delete")]}),children:(0,h.jsx)(w.h1,{type:"link",children:"..."})});var i};var F=t(69672),z=t(25389);const D=e=>{const n=(0,m.q)();return(0,p.useQuery)(["users",e],(()=>n("users",{data:e})))};var R=t(83773);const S=e=>{const{value:n,onChange:t,defaultOptionName:r,options:i,...s}=e;return(0,h.jsxs)(R.A,{value:null!==i&&void 0!==i&&i.length?Y(n):0,onChange:e=>null===t||void 0===t?void 0:t(Y(e)||void 0),...s,children:[r?(0,h.jsx)(R.A.Option,{value:0,children:r}):null,null===i||void 0===i?void 0:i.map((e=>(0,h.jsx)(R.A.Option,{value:e.id,children:e.name},e.id)))]})},Y=e=>isNaN(Number(e))?0:Number(e),Q=e=>{const{data:n}=D();return(0,h.jsx)(S,{options:n||[],...e})},V=e=>{let{users:n,param:t,setParam:r}=e;return(0,h.jsxs)(F.A,{style:{marginBottom:"2rem"},layout:"inline",children:[(0,h.jsx)(F.A.Item,{children:(0,h.jsx)(z.A,{placeholder:"\u9879\u76ee\u540d",type:"text",value:t.name,onChange:e=>r({...t,name:e.target.value})})}),(0,h.jsx)(F.A.Item,{children:(0,h.jsx)(Q,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:t.personId,onChange:e=>r({...t,personId:e})})})]})};var $=t(47419),B=t(33954);const H=()=>{(0,i.rN)("\u9879\u76ee\u5217\u8868",!1);const[e,n]=O(),{isLoading:t,error:r,data:s}=k((0,i.d7)(e,200)),{data:d}=D(),{open:l}=N();return(0,h.jsx)(B.U,{id:"\u9879\u76ee\u5217\u8868",children:(0,h.jsxs)(w.Mj,{children:[(0,h.jsxs)($.A,{style:{display:"flex",justifyContent:"space-between"},children:[(0,h.jsx)("h1",{children:"\u9879\u76ee\u5217\u8868"}),(0,h.jsx)(w.h1,{onClick:l,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]}),(0,h.jsx)(V,{users:d||[],param:e,setParam:n}),(0,h.jsx)(w.aV,{error:r}),(0,h.jsx)(P,{loading:t,users:d||[],dataSource:s||[]})]})})};H.whyDidYouRender=!1;var K,U,_=t(90684);function W(){return W=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},W.apply(null,arguments)}function G(e,n){let{title:t,titleId:i,...s}=e;return r.createElement("svg",W({viewBox:"0 0 179 32",xmlns:"http://www.w3.org/2000/svg",focusable:"false","aria-hidden":"true",className:"css-sq9aeg-Logo",ref:n,"aria-labelledby":i},s),t?r.createElement("title",{id:i},t):null,K||(K=r.createElement("defs",null,r.createElement("linearGradient",{x1:"97.6553341%",y1:"35.6591143%",x2:"37.202032%",y2:"75.4891864%",id:"uid392-1"},r.createElement("stop",{stopColor:"#0052CC",offset:"7%"}),r.createElement("stop",{stopColor:"#2684FF",offset:"100%"})),r.createElement("linearGradient",{x1:"8.43371138%",y1:"60.1495759%",x2:"64.1161517%",y2:"23.5790285%",id:"uid392-2"},r.createElement("stop",{stopColor:"#0052CC",offset:"0%"}),r.createElement("stop",{stopColor:"#2684FF",offset:"100%"})))),U||(U=r.createElement("g",{stroke:"none",strokeWidth:1,fillRule:"nonzero"},r.createElement("path",{d:"M11.3881081,27.9242105 C12.4881804,26.8071817 13.1062496,25.2917664 13.1062496,23.7115789 C13.1062496,22.1313915 12.4881804,20.6159762 11.3881081,19.4989474 L11.3881081,19.4989474 L3.74837838,11.7621053 L0.273513514,15.2926316 C-0.0900771727,15.6625064 -0.0900771727,16.2617042 0.273513514,16.6315789 L11.3881081,27.9242105 L11.3881081,27.9242105 Z",fill:"currentColor",fillRule:"nonzero"}),r.createElement("path",{d:"M22.5027027,15.2926316 L11.3881081,4 L11.3881081,4 L11.3539189,4.03473684 L11.3539189,4.03473684 C9.08852466,6.36456187 9.09963243,10.1156459 11.3787838,12.4315789 L19.0247297,20.1652632 L22.5027027,16.6315789 C22.8662934,16.2617042 22.8662934,15.6625064 22.5027027,15.2926316 Z",fill:"currentColor",fillRule:"nonzero"}),r.createElement("path",{d:"M11.3881081,12.4252632 C9.10895676,10.1093301 9.09784899,6.35824608 11.3632432,4.02842105 L3.43445946,12.0810526 L7.58067568,16.2936842 L11.3881081,12.4252632 Z",fill:"url(#uid392-1)",fillRule:"nonzero"}),r.createElement("path",{d:"M15.1893243,15.6368421 L11.3881081,19.4989474 C12.4881804,20.6159762 13.1062496,22.1313915 13.1062496,23.7115789 C13.1062496,25.2917664 12.4881804,26.8071817 11.3881081,27.9242105 L19.3355405,19.8494737 L15.1893243,15.6368421 Z",fill:"url(#uid392-2)",fillRule:"nonzero"}),r.createElement("path",{d:"M36.07,18.956 C36.07,20.646 35.394,21.842 33.418,21.842 C32.56,21.842 31.702,21.686 31,21.4 L31,23.662 C31.65,23.896 32.586,24.104 33.808,24.104 C37.032,24.104 38.41,21.946 38.41,18.8 L38.41,6.918 L36.07,6.918 L36.07,18.956 Z M41.894,7.568 C41.894,8.556 42.544,9.128 43.454,9.128 C44.364,9.128 45.014,8.556 45.014,7.568 C45.014,6.58 44.364,6.008 43.454,6.008 C42.544,6.008 41.894,6.58 41.894,7.568 Z M42.31,24 L44.546,24 L44.546,11 L42.31,11 L42.31,24 Z M47.926,24 L50.11,24 L50.11,16.33 C50.11,13.574 51.852,12.716 54.712,13.002 L54.712,10.818 C52.164,10.662 50.864,11.754 50.11,13.288 L50.11,11 L47.926,11 L47.926,24 Z M65.45,24 L65.45,21.66 C64.618,23.376 63.058,24.26 61.056,24.26 C57.598,24.26 55.856,21.322 55.856,17.5 C55.856,13.834 57.676,10.74 61.316,10.74 C63.214,10.74 64.67,11.598 65.45,13.288 L65.45,11 L67.686,11 L67.686,24 L65.45,24 Z M58.092,17.5 C58.092,20.62 59.34,22.18 61.654,22.18 C63.656,22.18 65.45,20.906 65.45,18.02 L65.45,16.98 C65.45,14.094 63.812,12.82 61.914,12.82 C59.392,12.82 58.092,14.484 58.092,17.5 Z M86.926,19.294 C86.926,16.226 84.898,15.056 81.284,14.146 C78.268,13.392 77.176,12.69 77.176,11.286 C77.176,9.726 78.502,8.946 80.738,8.946 C82.506,8.946 84.352,9.258 86.068,10.246 L86.068,7.906 C84.898,7.256 83.312,6.658 80.842,6.658 C76.864,6.658 74.836,8.634 74.836,11.286 C74.836,14.094 76.552,15.42 80.4,16.356 C83.65,17.136 84.586,17.942 84.586,19.45 C84.586,20.958 83.624,21.972 81.05,21.972 C78.788,21.972 76.344,21.374 74.758,20.542 L74.758,22.934 C76.084,23.61 77.618,24.26 80.92,24.26 C85.158,24.26 86.926,22.258 86.926,19.294 Z M95.09,24.26 C91.19,24.26 88.902,21.374 88.902,17.474 C88.902,13.574 91.19,10.74 95.09,10.74 C98.964,10.74 101.226,13.574 101.226,17.474 C101.226,21.374 98.964,24.26 95.09,24.26 Z M95.09,12.82 C92.308,12.82 91.086,15.004 91.086,17.474 C91.086,19.944 92.308,22.18 95.09,22.18 C97.846,22.18 99.042,19.944 99.042,17.474 C99.042,15.004 97.846,12.82 95.09,12.82 Z M106.92,9.622 C106.92,8.452 107.596,7.646 108.974,7.646 C109.494,7.646 109.988,7.698 110.378,7.776 L110.378,5.722 C109.988,5.618 109.546,5.514 108.87,5.514 C106.088,5.514 104.736,7.152 104.736,9.57 L104.736,11 L102.63,11 L102.63,13.08 L104.736,13.08 L104.736,24 L106.92,24 L106.92,13.08 L110.274,13.08 L110.274,11 L106.92,11 L106.92,9.622 Z M115.786,19.892 L115.786,13.08 L119.244,13.08 L119.244,11 L115.786,11 L115.786,8.244 L113.602,8.244 L113.602,11 L111.496,11 L111.496,13.08 L113.602,13.08 L113.602,19.944 C113.602,22.362 114.954,24 117.736,24 C118.412,24 118.854,23.896 119.244,23.792 L119.244,21.634 C118.854,21.712 118.36,21.816 117.84,21.816 C116.462,21.816 115.786,21.036 115.786,19.892 Z M125.432,24 L128.292,24 L130.528,17.708 L131.724,13.704 L132.92,17.708 L135.156,24 L138.016,24 L142.8,11 L140.33,11 L136.586,22.024 L132.79,11 L130.658,11 L126.862,22.024 L123.118,11 L120.648,11 L125.432,24 Z M153.538,24 L153.538,21.66 C152.706,23.376 151.146,24.26 149.144,24.26 C145.686,24.26 143.944,21.322 143.944,17.5 C143.944,13.834 145.764,10.74 149.404,10.74 C151.302,10.74 152.758,11.598 153.538,13.288 L153.538,11 L155.774,11 L155.774,24 L153.538,24 Z M146.18,17.5 C146.18,20.62 147.428,22.18 149.742,22.18 C151.744,22.18 153.538,20.906 153.538,18.02 L153.538,16.98 C153.538,14.094 151.9,12.82 150.002,12.82 C147.48,12.82 146.18,14.484 146.18,17.5 Z M159.154,24 L161.338,24 L161.338,16.33 C161.338,13.574 163.08,12.716 165.94,13.002 L165.94,10.818 C163.392,10.662 162.092,11.754 161.338,13.288 L161.338,11 L159.154,11 L159.154,24 Z M178.108,23.48 C177.042,24.052 175.404,24.26 174.078,24.26 C169.216,24.26 167.084,21.452 167.084,17.474 C167.084,13.548 169.268,10.74 173.22,10.74 C177.224,10.74 178.836,13.522 178.836,17.474 L178.836,18.488 L169.346,18.488 C169.658,20.698 171.088,22.128 174.156,22.128 C175.664,22.128 176.938,21.842 178.108,21.426 L178.108,23.48 Z M173.116,12.768 C170.75,12.768 169.554,14.302 169.32,16.564 L176.574,16.564 C176.444,14.146 175.352,12.768 173.116,12.768 Z",fill:"inherit",fillRule:"evenodd"}))))}const J=r.forwardRef(G);t.p;var X=t(20883),ee=t(89421),ne=t(86971);const te=e=>{const n=(0,m.q)();return(0,p.useQuery)(["kanbans",(0,i.jv)(e)],(()=>n("kanbans",{data:e})))},re=e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("kanbans/reorder",{data:e,method:"POST"})),(e=>g(e,((e,n)=>v({list:n,...e}))))(e))},ie=e=>{const n=(0,m.q)();return(0,p.useQuery)(["tasks",(0,i.jv)(e)],(()=>n("tasks",{data:e})))},se=e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("tasks/reorder",{data:e,method:"POST"})),(e=>g(e,((e,n)=>v({list:n,...e}).map((n=>n.id===e.fromId?{...n,kanbanId:e.toKanbanId}:n)))))(e))},de=()=>{var e;const{pathname:n}=(0,ne.zy)(),t=null===(e=n.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(t)},le=()=>M(de()),ae=()=>({projectId:de()}),oe=()=>["kanbans",ae()],ce=()=>{const[e]=E(["name","typeId","processorId","tagId"]),n=de();(0,i.d7)(e.name,200);return(0,r.useMemo)((()=>({projectId:n,typeId:Number(e.typeId)||void 0,processorId:Number(e.processorId)||void 0,tagId:Number(e.tagId)||void 0,name:e.name})),[n,e])},ue=()=>["tasks",ce()],xe=()=>{const[{editingTaskId:e},n]=E(["editingTaskId"]),{data:t,isLoading:i}=(e=>{const n=(0,m.q)();return(0,p.useQuery)(["task",{id:e}],(()=>n(`tasks/${e}`)),{enabled:Boolean(e)})})(Number(e));return{editingTaskId:e,editingTask:t,startEdit:(0,r.useCallback)((e=>{n({editingTaskId:e})}),[n]),close:(0,r.useCallback)((()=>{n({editingTaskId:""})}),[n]),isLoading:i}};const he=t.p+"static/media/task.97843ba7b03a0ef102d60b8a65987c60.svg";const je=t.p+"static/media/bug.87f92c270789254ceb55c5b5495f41a0.svg",me=()=>{const e=(0,m.q)();return(0,p.useQuery)(["taskTypes"],(()=>e("taskTypes")))};var pe=t(49635);const ve=e=>{let{kanbanId:n}=e;const[t,i]=(0,r.useState)(""),{mutateAsync:s}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("tasks",{data:e,method:"POST"})),L(e))})(ue()),d=de(),[l,a]=(0,r.useState)(!1),o=()=>a((e=>!e));return(0,r.useEffect)((()=>{l||i("")}),[l]),l?(0,h.jsx)(pe.A,{children:(0,h.jsx)(z.A,{onBlur:o,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:async()=>{await s({projectId:d,name:t,kanbanId:n}),a(!1),i("")},value:t,onChange:e=>i(e.target.value)})}):(0,h.jsx)("div",{onClick:o,children:"+\u521b\u5efa\u4e8b\u52a1"})},fe=e=>{let{name:n,keyword:t}=e;if(!t)return(0,h.jsx)(h.Fragment,{children:n});const r=n.split(t);return(0,h.jsx)(h.Fragment,{children:r.map(((e,n)=>(0,h.jsxs)("span",{children:[e,n===r.length-1?null:(0,h.jsx)("span",{style:{color:"#257AFD"},children:t})]},n)))})};var Ce=t(71395);const ge=e=>{let{children:n,...t}=e;return(0,h.jsx)(Ce.gL,{...t,children:e=>r.isValidElement(n)?r.cloneElement(n,{...e.droppableProps,ref:e.innerRef,provided:e}):(0,h.jsx)("div",{})})},ye=r.forwardRef(((e,n)=>{var t;let{children:r,...i}=e;return(0,h.jsxs)("div",{ref:n,...i,children:[r,null===(t=i.provided)||void 0===t?void 0:t.placeholder]})})),be=e=>{let{children:n,...t}=e;return(0,h.jsx)(Ce.sx,{...t,children:e=>r.isValidElement(n)?r.cloneElement(n,{...e.draggableProps,...e.dragHandleProps,ref:e.innerRef}):(0,h.jsx)("div",{})})},Le=e=>{var n;let{id:t}=e;const{data:r}=me(),i=null===r||void 0===r||null===(n=r.find((e=>e.id===t)))||void 0===n?void 0:n.name;return i?(0,h.jsx)("img",{alt:"task-icon",src:"task"===i?he:je}):null},ke=e=>{let{task:n}=e;const{startEdit:t}=xe(),{name:r}=ce();return(0,h.jsxs)(pe.A,{onClick:()=>t(n.id),style:{marginBottom:"0.5rem",cursor:"pointer"},children:[(0,h.jsx)("p",{children:(0,h.jsx)(fe,{keyword:r,name:n.name})}),(0,h.jsx)(Le,{id:n.typeId})]},n.id)},Ae=r.forwardRef(((e,n)=>{let{kanban:t,...r}=e;const{data:i}=ie(ce()),s=null===i||void 0===i?void 0:i.filter((e=>e.kanbanId===t.id));return(0,h.jsxs)(Me,{...r,ref:n,children:[(0,h.jsxs)(w.fI,{between:!0,children:[(0,h.jsx)("h3",{children:t.name}),(0,h.jsx)(Ie,{kanban:t},t.id)]}),(0,h.jsxs)(we,{children:[(0,h.jsx)(ge,{type:"ROW",direction:"vertical",droppableId:String(t.id),children:(0,h.jsx)(ye,{style:{minHeight:"5px"},children:null===s||void 0===s?void 0:s.map(((e,n)=>(0,h.jsx)(be,{index:n,draggableId:"task"+e.id,children:(0,h.jsx)("div",{children:(0,h.jsx)(ke,{task:e},e.id)})},e.id)))})}),(0,h.jsx)(ve,{kanbanId:t.id})]})]})})),Ie=e=>{let{kanban:n}=e;const{mutateAsync:t}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>{let{id:t}=e;return n(`kanbans/${t}`,{method:"DELETE"})}),y(e))})(oe()),r=(0,h.jsx)(a.A,{children:(0,h.jsx)(a.A.Item,{children:(0,h.jsx)(ee.A,{type:"link",onClick:()=>{d.A.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:()=>t({id:n.id})})},children:"\u5220\u9664"})})});return(0,h.jsx)(l.A,{overlay:r,children:(0,h.jsx)(ee.A,{type:"link",children:"..."})})},Me=X.A.div`
    min-width: 27rem;
    border-radius: 6px;
    background-color: rgb(244,245,247);
    display: flex;
    flex-direction: column;
    padding: 0.7rem 0.7rem 1rem;
    margin-right: 1.5rem;
`,we=X.A.div`
    overflow: scroll;
    flex: 1;
    ::-webkit-scrollbar{
        display: none;
    }
`,Ee=e=>{const{data:n}=me();return(0,h.jsx)(S,{options:n||[],...e})},Te=()=>{const e=ce(),n=T();return(0,h.jsxs)(w.fI,{marginBottom:4,gap:!0,children:[(0,h.jsx)(z.A,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:e.name,onChange:e=>n({name:e.target.value})}),(0,h.jsx)(Q,{defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:e=>n({processorId:e})}),(0,h.jsx)(Ee,{defaultOptionName:"\u7c7b\u578b",value:e.typeId,onChange:e=>n({typeId:e})}),(0,h.jsx)(ee.A,{onClick:()=>{n({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u6e05\u9664\u7b5b\u9009\u5668"})]})};var Oe=t(5397);const qe=()=>{const[e,n]=(0,r.useState)(""),t=de(),{mutateAsync:i}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("kanbans",{data:e,method:"POST"})),L(e))})(oe());return(0,h.jsx)(Me,{children:(0,h.jsx)(z.A,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:async()=>{await i({name:e,projectId:t}),n("")},value:e,onChange:e=>n(e.target.value)})})};var Ne=t(79605);const Pe={labelCol:{span:8},wrapperCol:{span:16}},Ze=()=>{const[e]=(0,Ne.A)(),{editingTaskId:n,editingTask:t,close:i}=xe(),{mutateAsync:s,isLoading:l}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n(`tasks/${e.id}`,{method:"PATCH",data:e})),b(e))})(ue()),{mutate:a}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>{let{id:t}=e;return n(`tasks/${t}`,{method:"DELETE"})}),y(e))})(ue());return(0,r.useEffect)((()=>{e.setFieldsValue(s)}),[e,t]),(0,h.jsxs)(d.A,{forceRender:!0,onCancel:()=>{i(),e.resetFields()},onOk:async()=>{await s({...t,...e.getFieldsValue()}),i()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:l,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!n,children:[(0,h.jsxs)(F.A,{...Pe,initialValues:t,form:e,children:[(0,h.jsx)(F.A.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:(0,h.jsx)(z.A,{})}),(0,h.jsx)(F.A.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,h.jsx)(Q,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),(0,h.jsx)(F.A.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,h.jsx)(Ee,{})})]}),(0,h.jsx)("div",{style:{textAlign:"right"},children:(0,h.jsx)(ee.A,{onClick:()=>{i(),d.A.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:()=>a({id:Number(n)})})},style:{fontSize:"14px"},size:"small",children:"\u5220\u9664"})})]})},Fe=()=>{(0,i.rN)("\u770b\u677f\u5217\u8868");const{data:e}=le(),{data:n,isLoading:t}=te(ae()),{isLoading:r}=ie(ce()),s=r||t,d=ze();return(0,h.jsx)(B.U,{id:"\u770b\u677f\u9875\u9762",children:(0,h.jsx)(Ce.JY,{onDragEnd:d,children:(0,h.jsxs)(w.Mj,{children:[(0,h.jsxs)("h1",{children:[null===e||void 0===e?void 0:e.name,"\u770b\u677f"]}),(0,h.jsx)(Te,{}),s?(0,h.jsx)(Oe.A,{size:"large"}):(0,h.jsxs)(De,{children:[(0,h.jsx)(ge,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,h.jsx)(ye,{style:{display:"flex"},children:null===n||void 0===n?void 0:n.map(((e,n)=>(0,h.jsx)(be,{draggableId:"kanban"+e.id,index:n,children:(0,h.jsx)(Ae,{kanban:e},e.id)},e.id)))})}),(0,h.jsx)(qe,{})]}),(0,h.jsx)(Ze,{})]})})})},ze=()=>{const{data:e}=te(ae()),{mutate:n}=re(oe()),{mutate:t}=se(ue()),{data:i=[]}=ie(ce());return(0,r.useCallback)((r=>{let{source:s,destination:d,type:l}=r;if(d){if("COLUMN"===l){const t=null===e||void 0===e?void 0:e[s.index].id,r=null===e||void 0===e?void 0:e[d.index].id;if(!t||!r||t===r)return;const i=d.index>s.index?"after":"before";n({fromId:t,referenceId:r,type:i})}if("ROW"===l){const e=+s.droppableId,n=+d.droppableId,r=i.filter((n=>n.kanbanId===e))[s.index],l=i.filter((e=>e.kanbanId===n))[d.index];if((null===r||void 0===r?void 0:r.id)===(null===l||void 0===l?void 0:l.id))return;t({fromId:null===r||void 0===r?void 0:r.id,referenceId:null===l||void 0===l?void 0:l.id,fromKanbanId:e,toKanbanId:n,type:e===n&&d.index>s.index?"after":"before"})}}}),[e,n,i,t])},De=(0,X.A)(ye)`
    display: flex;
    overflow-x: scroll;
    flex: 1;
`,Re=()=>({projectId:de()}),Se=()=>["epics",Re()];var Ye=t(75639),Qe=t(52128),Ve=t(27370);const $e=e=>{const{mutate:n,isLoading:t,error:i}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>n("epics",{data:e,method:"POST"})),L(e))})(Se()),[s]=(0,Ve.mN)(),d=de();return(0,r.useEffect)((()=>{s.resetFields()}),[s,e.visible]),(0,h.jsx)(Qe.A,{visible:e.visible,forceRender:!0,onClose:e.onClose,destroyOnClose:!0,width:"100%",children:(0,h.jsx)(Be,{children:t?(0,h.jsx)(Oe.A,{size:"large"}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,h.jsx)(w.aV,{error:i}),(0,h.jsxs)(F.A,{form:s,layout:"vertical",style:{width:"40rem"},onFinish:async t=>{await n({...t,projectId:d}),e.onClose()},children:[(0,h.jsx)(F.A.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}],children:(0,h.jsx)(z.A,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})}),(0,h.jsx)(F.A.Item,{style:{textAlign:"right"},children:(0,h.jsx)(ee.A,{loading:t,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},Be=X.A.div`
  height: 80vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,He=()=>{const{data:e}=le(),{data:n}=(e=>{const n=(0,m.q)();return(0,p.useQuery)(["epics",(0,i.jv)(e)],(()=>n("epics",{data:e})))})(Re()),{data:t}=ie({projectId:null===e||void 0===e?void 0:e.id}),{mutate:s}=(e=>{const n=(0,m.q)();return(0,p.useMutation)((e=>{let{id:t}=e;return n(`epics/${t}`,{method:"DELETE"})}),y(e))})(Se()),[l,a]=(0,r.useState)(!1);return(0,h.jsxs)(w.Mj,{children:[(0,h.jsxs)(w.fI,{between:!0,children:[(0,h.jsxs)("h1",{children:[null===e||void 0===e?void 0:e.name,"\u4efb\u52a1\u7ec4"]}),(0,h.jsx)(ee.A,{onClick:()=>a(!0),type:"link",children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,h.jsx)(Ye.Ay,{style:{overflow:"scroll"},dataSource:n,itemLayout:"vertical",renderItem:n=>(0,h.jsxs)(Ye.Ay.Item,{children:[(0,h.jsx)(Ye.Ay.Item.Meta,{title:(0,h.jsxs)(w.fI,{between:!0,children:[(0,h.jsx)("span",{children:n.name}),(0,h.jsx)(ee.A,{onClick:()=>(e=>{d.A.confirm({title:`\u786e\u5b9a\u5220\u9664\u9879\u76ee\u7ec4\uff1a${e.name}`,content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk(){s({id:e.id})}})})(n),type:"link",children:"\u5220\u9664"})]}),description:(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",c()(n.start).format("YYYY-MM-DD")," "]}),(0,h.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",c()(n.end).format("YYYY-MM-DD")," "]})]})}),(0,h.jsx)("div",{children:null===t||void 0===t?void 0:t.filter((e=>e.epicId===n.id)).map((n=>(0,h.jsx)(u.N_,{to:`/projects/${null===e||void 0===e?void 0:e.id}/kanban?editingTaskId=${n.id}`,children:n.name},n.id)))})]})}),(0,h.jsx)($e,{onClose:()=>a(!1),visible:l})]})},Ke=()=>{const e=(0,ne.zy)().pathname.split("/");return e[e.length-1]},Ue=()=>(0,h.jsxs)(Ge,{children:[(0,h.jsx)(_e,{children:(0,h.jsxs)(a.A,{mode:"inline",children:[(0,h.jsx)(a.A.Item,{selectedKeys:[Ke()],children:(0,h.jsx)(u.N_,{to:"kanban",children:"\u770b\u677f"})},"kanban"),(0,h.jsx)(a.A.Item,{children:(0,h.jsx)(u.N_,{to:"epic",children:"\u4efb\u52a1\u7ec4"})},"epic")]})}),(0,h.jsx)(We,{children:(0,h.jsxs)(ne.BV,{children:[(0,h.jsx)(ne.qh,{path:"kanban",element:(0,h.jsx)(Fe,{})}),(0,h.jsx)(ne.qh,{path:"epic",element:(0,h.jsx)(He,{})}),(0,h.jsx)(ne.qh,{path:"*",element:(0,h.jsx)(ne.C5,{to:window.location.pathname+"/kanban",replace:!0})})," "]})})]}),_e=X.A.div`
    background-color: rgb(244,245,247);
    display: flex;
`,We=X.A.div`
    box-shadow: -5px 0 -5px -5px rgba(0,0,0,0.1);
    display: flex; 
    overflow: hidden;
`,Ge=X.A.div`
    display: grid;
    grid-template-columns: 16rem 1fr;
    width: 100%;
`,Je=()=>{const{projectModalOpen:e,close:n,editingProject:t,isLoading:i}=N(),s=t?A:I,{mutateAsync:d,error:l,isLoading:a}=s(q()),[o]=F.A.useForm(),c=t?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,r.useEffect)((()=>{o.setFieldsValue(t)}),[t,o]),(0,h.jsx)(Qe.A,{forceRender:!0,onClose:()=>{o.resetFields(),n()},visible:e,width:"100%",children:(0,h.jsx)(Xe,{children:i?(0,h.jsx)(Oe.A,{size:"large"}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("h1",{children:c}),(0,h.jsx)(w.aV,{error:l}),(0,h.jsxs)(F.A,{form:o,layout:"vertical",style:{width:"40rem"},onFinish:e=>{d({...t,...e}).then((()=>{o.resetFields(),n()}))},children:[(0,h.jsx)(F.A.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"}],children:(0,h.jsx)(z.A,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"})}),(0,h.jsx)(F.A.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"}],children:(0,h.jsx)(z.A,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"})}),(0,h.jsx)(F.A.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId",children:(0,h.jsx)(Q,{defaultOptionName:"\u8d1f\u8d23\u4eba"})}),(0,h.jsx)(F.A.Item,{style:{textAlign:"right"},children:(0,h.jsx)(ee.A,{loading:a,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},Xe=X.A.div`
  height: 80vh;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`;var en=t(27239),nn=t(39998),tn=t(42857);const rn=()=>{const{open:e}=N(),{data:n,refetch:t}=k(),r=null===n||void 0===n?void 0:n.filter((e=>e.pin)),i=(0,h.jsxs)(sn,{children:[(0,h.jsx)(en.A.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),(0,h.jsx)(Ye.Ay,{children:null===r||void 0===r?void 0:r.map((e=>(0,h.jsx)(Ye.Ay.Item,{children:(0,h.jsx)(Ye.Ay.Item.Meta,{title:e.name})},e.id)))}),(0,h.jsx)(nn.A,{}),(0,h.jsx)(w.h1,{onClick:e,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]});return(0,h.jsx)(tn.A,{onVisibleChange:()=>t(),placement:"bottom",content:i,children:(0,h.jsx)("span",{children:"\u9879\u76ee"})})},sn=X.A.div`
  min-width: 30rem;
  /* border: 5px solid black; */
`,dn=()=>{const{data:e,refetch:n}=D(),t=(0,h.jsxs)(ln,{children:[(0,h.jsx)(en.A.Text,{type:"secondary",children:"\u7ec4\u5458\u5217\u8868"}),(0,h.jsx)(Ye.Ay,{children:null===e||void 0===e?void 0:e.map((e=>(0,h.jsx)(Ye.Ay.Item,{children:(0,h.jsx)(Ye.Ay.Item.Meta,{title:e.name})},e.id)))}),(0,h.jsx)(nn.A,{})]});return(0,h.jsx)(tn.A,{onVisibleChange:()=>n(),placement:"bottom",content:t,children:(0,h.jsx)("span",{children:"\u7ec4\u5458"})})},ln=X.A.div`
  min-width: 30rem;
  /* border: 5px solid black; */
`;function an(){return(0,h.jsxs)(un,{children:[(0,h.jsx)(on,{}),(0,h.jsx)(mn,{children:(0,h.jsxs)(ne.BV,{children:[(0,h.jsx)(ne.qh,{path:"projects",element:(0,h.jsx)(H,{})}),(0,h.jsx)(ne.qh,{path:"projects/:projectId/*",element:(0,h.jsx)(Ue,{})}),(0,h.jsx)(ne.qh,{index:!0,element:(0,h.jsx)(H,{})})]})}),(0,h.jsx)(Je,{})]})}const on=()=>(0,h.jsxs)(xn,{between:!0,children:[(0,h.jsxs)(hn,{gap:!0,children:[(0,h.jsx)(w.h1,{type:"link",onClick:i.Xb,children:(0,h.jsx)(J,{width:"18rem",color:"rgb(38, 132, 255)"})}),(0,h.jsx)(rn,{}),(0,h.jsx)(dn,{})]}),(0,h.jsx)(jn,{children:(0,h.jsx)(cn,{})})]}),cn=()=>{const{logout:e,user:n}=(0,_.A)();return(0,h.jsx)(l.A,{overlay:(0,h.jsx)(a.A,{children:(0,h.jsx)(a.A.Item,{children:(0,h.jsx)(ee.A,{onClick:e,type:"link",children:"\u767b\u51fa"})},"logout")}),children:(0,h.jsxs)(ee.A,{type:"link",onClick:e=>e.preventDefault(),children:["Hi, ",null===n||void 0===n?void 0:n.name]})})},un=X.A.div`
  display: grid;
  grid-template-rows: 6rem 1fr;
  height: 100vh;
  width: 100vw;
  margin: 0 auto;
  /* border: 5px solid black; */
`,xn=(0,X.A)(w.fI)`
  padding: 3.2rem;
  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);
  z-index: 1;
`,hn=(0,X.A)(w.fI)``,jn=X.A.div``,mn=X.A.main`
  display: flex;
  overflow: scroll;
  justify-content: space-between;
  /* align-items: center; */
  width: 100%;
  /* border: 5px solid black;  */
`}}]);
//# sourceMappingURL=47.2e6e62bc.chunk.js.map